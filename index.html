<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>버추얼 테이블 프로젝트 대화형 보고서</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f7f4;
            color: #333;
        }
        .timeline-item {
            position: relative;
            padding-left: 2.5rem;
            padding-bottom: 2rem;
            cursor: pointer;
        }
        .timeline-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0.5rem;
            width: 2px;
            height: 100%;
            background-color: #d1d5db;
        }
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 0.25rem;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 9999px;
            border: 4px solid #f8f7f4;
            transition: transform 0.2s;
        }
        .timeline-item.active .timeline-dot {
            transform: scale(1.2);
        }
        .timeline-item.active {
            font-weight: 700;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem;
            background-color: #e5e7eb;
        }
        .video-container iframe, .video-container div {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .flow-step {
            position: relative;
            padding-left: 2.5rem;
        }
        .flow-step:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 1.75rem;
            width: 2px;
            height: calc(100% + 1rem);
            background-color: #d1d5db;
        }
        .flow-dot {
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 1.75rem;
            height: 1.75rem;
            border-radius: 9999px;
            background-color: #3b82f6;
            border: 4px solid #eff6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        /* Poker Table Styles from the seating simulation */
        .poker-table {
            position: relative;
            width: 280px;
            height: 160px;
            background-color: #059669; /* A rich green */
            border: 10px solid #78350f; /* Wood-like border */
            border-radius: 80px / 80px; /* Oval shape */
            margin: 1.5rem auto 0;
        }
        .seat {
            position: absolute;
            width: 32px;
            height: 32px;
            background-color: #4b5563; /* Dark grey */
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transform: translate(-50%, -50%);
        }
        .dealer {
            background-color: #1f2937; /* Even darker for dealer */
            width: 60px;
            height: 28px;
            border-radius: 8px;
            font-size: 0.75rem;
        }
        .player-active {
            background-color: #2563eb; /* Bright blue for active players */
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">버추얼 테이블 프로젝트</h1>
            <p class="text-lg text-gray-600">리허설 경과 및 성과 대시보드</p>
            <button id="showSeatingModalBtn" class="mt-4 inline-flex items-center px-5 py-2.5 bg-gray-800 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-opacity-75 transition-colors text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path fill-rule="evenodd" d="M.458 10C3.732 4.943 9.522 3 10 3s6.268 1.943 9.542 7c-3.274 5.057-9.064 7-9.542 7S3.732 15.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                헤즈업 좌석 배치 시뮬레이션 보기
            </button>
        </header>

        <main>
             <section id="rehearsal-timeline" class="mb-12">
                <h2 class="text-2xl font-bold text-gray-700 mb-8 text-center">리허설 진행 타임라인</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div id="timeline-nav" class="lg:col-span-1">
                        <!-- 타임라인 항목이 여기에 동적으로 생성됩니다. -->
                    </div>
                    <div id="timeline-details" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md min-h-[300px]">
                        <!-- 선택된 항목의 상세 정보가 여기에 표시됩니다. -->
                    </div>
                </div>
            </section>

             <section id="process-flow" class="mb-12">
                <h2 class="text-2xl font-bold text-gray-700 mb-8 text-center">버추얼 테이블 상세 프로세스</h2>
                <div class="bg-white p-8 rounded-xl shadow-md max-w-4xl mx-auto">
                    <div class="space-y-8">
                        <div class="flow-step">
                            <div class="flow-dot">1</div>
                            <h3 class="text-lg font-bold text-gray-800">주요 선수 선정</h3>
                            <p class="text-gray-600">버추얼 테이블 2~3명, 피처 테이블 각 1명씩 총 4~5명 선정하여 시청자 관점에서 주요 선수들에게 집중할 수 있는 환경 마련</p>
                        </div>
                        <div class="flow-step">
                            <div class="flow-dot">2</div>
                            <h3 class="text-lg font-bold text-gray-800">상황 파악 및 촬영 준비</h3>
                            <p class="text-gray-600">현장 PD, 카메라, 데이터 매니저가 테이블을 순회하며 상황을 파악하고, 주요 선수의 좋은 핸드가 감지되면 모든 스탭을 호출하여 촬영을 시작합니다.</p>
                        </div>
                        <div class="flow-step">
                            <div class="flow-dot">3</div>
                            <h3 class="text-lg font-bold text-gray-800">데이터 수집 및 촬영</h3>
                            <p class="text-gray-600">데이터 매니저는 아래 항목들을 포함한 핸드의 상세 데이터를 수집합니다.</p>
                            <div class="mt-2 pl-4 grid grid-cols-1 md:grid-cols-2 gap-x-8">
                                <div>
                                    <h4 class="font-semibold text-gray-700">핸드 데이터</h4>
                                    <ul class="list-disc list-inside mt-1 space-y-1 text-gray-500">
                                        <li>보드 카드</li>
                                        <li>플레이어 카드</li>
                                        <li>플레이어 액션 및 액션별 칩</li>
                                        <li>팟 사이즈 / 칩 스택</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-700 mt-2 md:mt-0">편집 데이터</h4>
                                    <ul class="list-disc list-inside mt-1 space-y-1 text-gray-500">
                                        <li>노터블 플레이어</li>
                                        <li>인점 가이드</li>
                                        <li>카드 오픈 여부 (미스터리 핸드 스타일)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-dot">4</div>
                            <h3 class="text-lg font-bold text-gray-800">데이터 정리</h3>
                            <p class="text-gray-600">촬영 완료 후, 데이터 매니저는 촬영 파일명을 데이터 시트에 정확히 기록합니다.</p>
                        </div>
                         <div class="flow-step">
                            <div class="flow-dot">5</div>
                            <h3 class="text-lg font-bold text-gray-800">소스 전달 및 검증</h3>
                            <p class="text-gray-600">카메라 메모리카드를 후반 편집자에게 전달하고, 편집자는 구글 시트와 촬영본을 대조하여 검증합니다.</p>
                        </div>
                         <div class="flow-step">
                            <div class="flow-dot">6</div>
                            <h3 class="text-lg font-bold text-gray-800">그래픽 제작 및 컷 편집 (병렬 진행)</h3>
                            <p class="text-gray-600">검증 완료 후, 아래 작업들이 동시에 진행됩니다.</p>
                            <ul class="list-disc list-inside mt-2 space-y-1 text-gray-500 pl-4">
                                <li>포커 GUI 그래픽 생성</li>
                                <li>컷 편집 (복수 캠의 경우)</li>
                            </ul>
                        </div>
                        <div class="flow-step">
                            <div class="flow-dot">7</div>
                            <h3 class="text-lg font-bold text-gray-800">최종 편집</h3>
                             <p class="text-gray-600">영상에 포커 GUI 그래픽을 삽입하고, 인/아웃점을 편집합니다.</p>
                        </div>
                         <div class="flow-step">
                            <div class="flow-dot">8</div>
                            <h3 class="text-lg font-bold text-gray-800">콘텐츠 추출 및 전송</h3>
                             <p class="text-gray-600">최종 완성된 콘텐츠를 추출하여 한국으로 전송합니다.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Seating Arrangement Modal -->
    <div id="seatingModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-100 rounded-2xl shadow-2xl w-full max-w-7xl h-full max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0" id="seatingModalContent">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-300">
                 <h2 class="text-2xl font-bold text-gray-800">헤즈업 좌석 배치 시뮬레이션</h2>
                <button id="closeSeatingModalBtn" class="text-gray-500 hover:text-gray-800">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <!-- Modal Body -->
            <div class="flex-grow p-4 md:p-6 overflow-y-auto">
                <header class="text-center mb-6">
                    <p class="text-md text-gray-600">카메라 촬영 테스트를 위한 10가지 무작위 헤즈업 시나리오입니다.</p>
                    <button id="randomize-button-modal" class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-colors">
                        핸드 재배치
                    </button>
                </header>
                <main id="seating-grid-modal" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                    <!-- 10개의 좌석 배치 시나리오가 여기에 동적으로 생성됩니다. -->
                </main>
            </div>
        </div>
    </div>


    <script>
        const rehearsalData = {
            '1': {
                id: '1', date: '8/22', status: '완료', goal: '현장 감각 습득 및 기본 개념 파악', location: '강남 뉴스톤', duration: '7시간',
                participants: { '카메라': '매튜, 카이', '데이터 매니저': '트레이', '후반 편집': '에이든' },
                results: [
                    { type: 'issue', text: '소니 카메라 장비가 무거워 경량화 필요.' },
                    { type: 'improvement', text: '후반 편집 의문점 해결을 위한 현장팀과의 소통 채널 강화 필요.' },
                    { type: 'improvement', text: '2카메라 운영 시, 명확한 사전 역할 분담 및 동선 합의 필수.' }
                ],
                videos: [
                    { id: 'KkqwcWT4MF4', title: '초기 테스트 결과물 (메인 앵글)', description: '소니 카메라로 촬영한 메인 영상입니다.' },
                ]
            },
            '2': {
                id: '2', date: '8/28', status: '완료', goal: '프로세스 정립 및 2카메라 테스트', location: 'GGP 스튜디오', duration: '2시간',
                participants: { '카메라': '에이든, 카이', '데이터 매니저': '헨리', '후반 편집': '던' },
                results: [
                    { type: 'decision', text: '사내 액션캠은 화질 저하로 실전 사용 불가. 프로덕션용 카메라 사용 결정.' },
                    { type: 'issue', text: '슬랙을 통한 데이터 전송 방식 비효율적.' },
                    { type: 'issue', text: '노트북+구글 시트 방식의 데이터 매니징은 현장에 부적합. 모바일 기반 방식 모색 필요.' }
                ],
                videos: [
                    { id: 'JHBz5SyzEwM', title: '2카메라 테스트 영상', description: '프로덕션용 카메라 2대를 사용하여 동시 촬영한 결과물입니다.' }
                ]
            },
            '3': {
                id: '3', date: '8/29', status: '완료', goal: 'CYPRUS 현장 네트워크(10~20mb) 환경 테스트', location: 'GGP 스튜디오', duration: '2시간',
                participants: { '카메라': '에이든, 매튜', '데이터 매니저': '헨리', '후반 편집': '던' },
                results: [
                    { type: 'issue', text: '전송 시간 과다 소요 (700mb 파일 기준 25~30분).' },
                    { type: 'decision', text: '현장 편집 방식으로 신속하게 프로세스를 변경하여 테스트 → 콘텐츠 제작 시간 40-50분에서 15-25분으로 단축 성공.'},
                    { type: 'improvement', text: '효율적인 현장 편집을 위해 숙련된 GFX/편집자 배정 필수.'},
                    { type: 'issue', text: '데이터 매니징 앱의 UI/UX가 직관적이지 않고 버그 존재. 개선 필요.' }
                ],
                videos: [
                    { id: 'KEibhwfM8HA', title: '현장 편집 워크플로우 적용 영상', description: '데이터 수집부터 최종 편집까지 현장에서 완료한 첫 결과물입니다. (소요 시간: 약 20분)' }
                ]
            },
            '4': {
                id: '4', date: '9/1', status: '완료',
                goal: [
                    '후반 비숙련 작업자의 작업 속도 측정',
                    '액션캠으로 촬영했을때의 화질 검토',
                    '데이터 매니징 앱의 효율성 검토'
                ],
                location: 'GGP 스튜디오', duration: '1시간 (10핸드 진행)',
                participants: { '카메라': '에이든, 카이', '데이터 매니징': '헨리', '후반 작업': '마이크' },
                results: [
                     { type: 'issue', text: '오즈모 포켓 3: 사용성은 뛰어나지만, 광각에서는 양호한 화질을 보이나 줌인 시 화질 저하가 심하고 단조로운 화면을 제공하여 메인 카메라 활용 여부는 추가 검토가 필요합니다.'},
                     { type: 'issue', text: '데이터 매니징 앱: 작업자 미숙지로 인한 데이터 오입력 발생. 사용자 교육 필요성 확인.'}
                ],
                videos: [
                    { id: '3BwVctioVbw', title: '4차 리허설 결과물 (오즈모 포켓 3 테스트)', description: '카메라: 2대, 작업 시간: 24분, 결과물: 34초' }
                ]
            },
            '5': {
                id: '5', date: '9월 2주차', status: '계획', goal: '현장 편집 워크플로우 숙련도 향상', location: '미정', duration: '미정',
                participants: { '참여 인원': '미정' },
                results: [
                    { type: 'pending', text: '외주 인력 교육 및 비상 상황 대비 훈련.' }
                ],
                videos: []
            },
            '6': {
                id: '6', date: '9월 3주차', status: '계획', goal: '데이터 매니징 앱 개선사항 테스트', location: '미정', duration: '미정',
                participants: { '참여 인원': '미정' },
                results: [
                    { type: 'pending', text: 'UI/UX 개선 피드백 반영 및 버그 수정 확인.' }
                ],
                videos: []
            }
        };
        
        const statusConfig = {
            '완료': { color: 'bg-green-500', text: '완료' },
            '예정': { color: 'bg-blue-500', text: '예정' },
            '계획': { color: 'bg-gray-400', text: '계획' },
        };

        function createResultItem(result, status) {
            const icons = {
                issue: `<svg class="w-6 h-6 text-red-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                improvement: `<svg class="w-6 h-6 text-yellow-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                decision: `<svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
                pending: `<svg class="w-6 h-6 text-gray-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`
            };
            return `<li class="flex items-start">${icons[result.type]}<span class="text-gray-700">${result.text}</span></li>`;
        }
        
        function renderRehearsalDetails(rehearsalId) {
            const data = rehearsalData[rehearsalId];
            const detailsEl = document.getElementById('timeline-details');
            
            const goalHtml = Array.isArray(data.goal)
                ? `<ul class="list-disc list-inside space-y-1">${data.goal.map(g => `<li>${g}</li>`).join('')}</ul>`
                : data.goal;

            const participantsHtml = Object.entries(data.participants).map(([role, names]) => 
                `<div class="text-sm"><span class="font-semibold">${role}:</span> ${names}</div>`
            ).join('');
            
            let resultsContentHtml = '';
            if (rehearsalId === '4') {
                resultsContentHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200 flex flex-col">
                           <div class="flex items-center text-green-600 mb-2">
                               <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                               <h4 class="text-lg font-bold">작업 성과</h4>
                           </div>
                           <div class="text-center mt-2 flex-grow">
                               <p class="text-sm text-gray-600">비숙련 작업자 (마이크) / 34초 영상</p>
                               <p class="text-4xl font-bold text-green-700 my-1">24<span class="text-2xl font-medium">분</span></p>
                               <p class="text-sm text-gray-500">(편집 7분, GFX 10분)</p>
                           </div>
                       </div>
                       <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 flex flex-col">
                           <div class="flex items-center text-yellow-700 mb-2">
                                <svg class="w-8 h-8 mr-2 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                               <h4 class="text-lg font-bold">향후 목표</h4>
                           </div>
                            <div class="text-center mt-2 flex-grow">
                               <p class="text-sm text-gray-600">본사 전달 시간</p>
                               <p class="text-4xl font-bold text-yellow-800 my-1">12<span class="text-2xl font-medium">분</span></p>
                               <p class="text-sm text-gray-500">(전송 시간 포함)</p>
                           </div>
                       </div>
                    </div>
                    <div class="mt-6 pt-4 border-t">
                        <h4 class="text-md font-bold text-gray-700 mb-3">주요 이슈 및 피드백</h4>
                        <ul class="space-y-3">
                            ${data.results.map(res => createResultItem(res, data.status)).join('')}
                        </ul>
                    </div>
                `;
            } else {
                 resultsContentHtml = `<ul class="space-y-3">${data.results.map(res => createResultItem(res, data.status)).join('')}</ul>`;
            }

            const resultTitle = data.status === '예정' ? '예상 결과 및 피드백' : '결과 및 피드백';

            let finalHtml = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-1">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">${rehearsalId}차 리허설 (${data.date})</h3>
                        <div class="space-y-2 text-gray-600">
                            <div><strong class="text-gray-700">목표:</strong><div class="mt-1 pl-1">${goalHtml}</div></div>
                            <p><strong class="text-gray-700">장소:</strong> ${data.location}</p>
                            <p><strong class="text-gray-700">시간:</strong> ${data.duration}</p>
                        </div>
                        <h4 class="font-bold text-gray-800 mt-6 mb-2">참여 인원</h4>
                        <div class="space-y-1 text-gray-600">${participantsHtml}</div>
                    </div>
                    <div class="md:col-span-2">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">${resultTitle}</h3>
                        <div>${resultsContentHtml}</div>
                    </div>
                </div>
            `;

            if (data.videos && data.videos.length > 0) {
                const videosHtml = data.videos.map(video => {
                    const videoContent = video.id 
                        ? `<iframe src="https://www.youtube.com/embed/${video.id}?controls=1&rel=0&modestbranding=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>`
                        : `<div class="w-full h-full flex items-center justify-center bg-gray-200 text-gray-500 rounded-lg">영상 ID가 올바르지 않습니다.</div>`;
                    
                    return `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="video-container mb-3">
                                ${videoContent}
                            </div>
                            <h4 class="text-md font-bold text-gray-800">${video.title}</h4>
                            ${video.description ? `<p class="text-sm text-gray-600 mt-1">${video.description}</p>` : ''}
                        </div>
                    `;
                }).join('');
                
                finalHtml += `
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">결과물 영상</h3>
                        <div class="space-y-6">
                            ${videosHtml}
                        </div>
                    </div>
                `;
            } else if (data.hasOwnProperty('videos')) {
                finalHtml += `
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">결과물 영상</h3>
                        <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-center text-gray-500 min-h-[120px]">
                            <p>공유된 영상이 아직 없습니다.</p>
                        </div>
                    </div>
                `;
            }
            detailsEl.innerHTML = finalHtml;
        }

        function generateTimelineNav() {
            const navEl = document.getElementById('timeline-nav');
            navEl.innerHTML = '';
            Object.values(rehearsalData).forEach(item => {
                const config = statusConfig[item.status];
                const itemEl = document.createElement('div');
                itemEl.className = 'timeline-item';
                itemEl.dataset.id = item.id;
                const goalText = Array.isArray(item.goal) ? item.goal[0] : item.goal;
                itemEl.innerHTML = `
                    <div class="timeline-dot ${config.color}"></div>
                     <div class="flex items-center gap-2 mb-1">
                        <div class="flex items-center bg-gray-200 rounded-full px-2 py-0.5">
                            <svg class="w-4 h-4 text-gray-600 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <time class="text-xs font-bold text-gray-700">${item.date}</time>
                        </div>
                        <span class="text-sm font-semibold text-gray-600">${config.text}</span>
                    </div>
                    <p class="text-md text-gray-800">${goalText}</p>
                `;
                navEl.appendChild(itemEl);
            });

            navEl.addEventListener('click', (e) => {
                const targetItem = e.target.closest('.timeline-item');
                if (targetItem) {
                    const currentActive = navEl.querySelector('.active');
                    if (currentActive) {
                        currentActive.classList.remove('active', 'text-blue-600');
                    }
                    targetItem.classList.add('active', 'text-blue-600');
                    renderRehearsalDetails(targetItem.dataset.id);
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            generateTimelineNav();
            
            const today = new Date('2025-09-01T00:00:00'); // Set a fixed 'today' for consistency

            function parseDate(dateStr) {
                if (dateStr.includes('/')) {
                    const [month, day] = dateStr.split('/');
                    return new Date(`2025-${month}-${day}`);
                }
                if (dateStr.includes('주차')) {
                    const month = parseInt(dateStr.match(/(\d+)월/)[1]);
                    const week = parseInt(dateStr.match(/(\d+)주차/)[1]);
                    const day = (week - 1) * 7 + 1;
                    return new Date(`2025-${month}-${day}`);
                }
                return null;
            }

            let closestRehearsalId = null;
            let minDiff = Infinity;

            Object.values(rehearsalData).forEach(item => {
                const itemDate = parseDate(item.date);
                if (itemDate) {
                    const diff = Math.abs(itemDate.getTime() - today.getTime());
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestRehearsalId = item.id;
                    }
                }
            });

            const initialItemId = closestRehearsalId || '1';
            const initialItemEl = document.querySelector(`.timeline-item[data-id='${initialItemId}']`);

            if (initialItemEl) {
                initialItemEl.classList.add('active', 'text-blue-600');
                renderRehearsalDetails(initialItemEl.dataset.id);
            }
            
            // --- Seating Modal Logic ---
            const modal = document.getElementById('seatingModal');
            const modalContent = document.getElementById('seatingModalContent');
            const showBtn = document.getElementById('showSeatingModalBtn');
            const closeBtn = document.getElementById('closeSeatingModalBtn');
            const randomizeBtnModal = document.getElementById('randomize-button-modal');
            const gridContainerModal = document.getElementById('seating-grid-modal');

            const numPlayerSeats = 9;
            const tableWidth = 280;
            const tableHeight = 160;
            const players = Array.from({ length: numPlayerSeats }, (_, i) => i + 1);

            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            function generateScenarios() {
                const scenarios = [];
                for (let i = 0; i < 10; i++) {
                    const shuffledPlayers = shuffleArray(players);
                    scenarios.push([shuffledPlayers[0], shuffledPlayers[1]]);
                }
                return scenarios;
            }

            function renderModalScenarios(seatingScenarios) {
                gridContainerModal.innerHTML = '';
                seatingScenarios.forEach((activePlayers, index) => {
                    const handNumber = index + 1;
                    const scenarioCard = document.createElement('div');
                    scenarioCard.className = 'bg-white p-4 rounded-xl shadow-md';
                    scenarioCard.innerHTML = `<h3 class="text-xl font-bold text-center text-gray-700">Hand ${handNumber}</h3>`;
                    
                    const tableContainer = document.createElement('div');
                    tableContainer.className = 'poker-table';

                    const totalArc = 270; 
                    const startAngle = -225;
                    const angleStep = totalArc / (numPlayerSeats - 1);

                    for (let i = 0; i < numPlayerSeats; i++) {
                        const seat = document.createElement('div');
                        const seatNumber = i + 1;
                        
                        const angleDegrees = startAngle + (i * angleStep);
                        const angleRadians = angleDegrees * (Math.PI / 180);
                        
                        const x = (tableWidth / 2) * Math.cos(angleRadians);
                        const y = (tableHeight / 2) * Math.sin(angleRadians);
                        
                        seat.className = 'seat';
                        seat.textContent = seatNumber;
                        
                        if (activePlayers.includes(seatNumber)) {
                            seat.classList.add('player-active');
                        }
                        
                        seat.style.left = `calc(50% + ${x}px)`;
                        seat.style.top = `calc(50% + ${y}px)`;
                        tableContainer.appendChild(seat);
                    }

                    const dealer = document.createElement('div');
                    dealer.className = 'seat dealer';
                    dealer.textContent = 'DEALER';
                    dealer.style.left = '50%';
                    dealer.style.top = '100%';
                    tableContainer.appendChild(dealer);
                    
                    scenarioCard.appendChild(tableContainer);
                    gridContainerModal.appendChild(scenarioCard);
                });
            }
            
            showBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
                setTimeout(() => {
                   modalContent.classList.remove('scale-95', 'opacity-0');
                }, 10); // Start transition
                renderModalScenarios(generateScenarios());
            });

            closeBtn.addEventListener('click', () => {
                 modalContent.classList.add('scale-95', 'opacity-0');
                 setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300); // Wait for transition to finish
            });

            randomizeBtnModal.addEventListener('click', () => {
                renderModalScenarios(generateScenarios());
            });
        });
    </script>
</body>
</html>

